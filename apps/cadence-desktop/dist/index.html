<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Cadence Desktop</title>
    <style>
      :root {
        color-scheme: dark light;
        font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
        background: #111;
        color: #f5f5f5;
      }

      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: radial-gradient(circle at top, #1d1d35, #090909);
      }

      main {
        width: min(640px, 90vw);
        border-radius: 16px;
        padding: 32px;
        background: rgba(18, 20, 34, 0.9);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
        backdrop-filter: blur(16px);
      }

      h1 {
        margin-top: 0;
        font-size: 1.8rem;
        font-weight: 600;
      }

      .row {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        flex-wrap: wrap;
      }

      input[type="text"] {
        flex: 1 1 320px;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(9, 9, 15, 0.9);
        color: inherit;
        font-size: 0.95rem;
      }

      button {
        padding: 10px 18px;
        font-size: 0.95rem;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        background: linear-gradient(135deg, #36d1dc, #5b86e5);
        color: #fff;
        transition: transform 120ms ease, box-shadow 120ms ease;
      }

      button.secondary {
        background: rgba(255, 255, 255, 0.08);
      }

      button:active {
        transform: scale(0.97);
        box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.12);
      }

      #playing {
        margin-top: 24px;
        font-size: 0.95rem;
        padding: 14px 18px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.04);
      }

      #status {
        display: block;
        margin-top: 12px;
        font-size: 0.85rem;
        opacity: 0.7;
        min-height: 1em;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Cadence Player</h1>
      <p>Point at an audio file on disk to kick the playback engine. More polished UI coming soon.</p>

      <div class="row">
        <input type="text" id="path-input" placeholder="C:\Music\track.mp3" spellcheck="false" />
        <button id="browse-btn" class="secondary">Browseâ€¦</button>
        <button id="play-btn">Play</button>
      </div>

      <div class="row">
        <button id="pause-btn" class="secondary">Pause</button>
        <button id="resume-btn" class="secondary">Resume</button>
        <button id="stop-btn" class="secondary">Stop</button>
      </div>

      <div id="playing">
        <strong>Now Playing</strong>
        <div id="track-path">-</div>
        <div id="duration">Duration: -</div>
        <span id="status"></span>
      </div>
    </main>

    <script>
      const { invoke } = window.__TAURI__.tauri;

      const pathInput = document.querySelector("#path-input");
      const playBtn = document.querySelector("#play-btn");
      const browseBtn = document.querySelector("#browse-btn");
      const pauseBtn = document.querySelector("#pause-btn");
      const resumeBtn = document.querySelector("#resume-btn");
      const stopBtn = document.querySelector("#stop-btn");
      const trackPath = document.querySelector("#track-path");
      const duration = document.querySelector("#duration");
      const status = document.querySelector("#status");

      async function play() {
        const path = pathInput.value.trim();
        if (!path) {
          status.textContent = "Please enter a path first.";
          return;
        }

        status.textContent = "Starting playback.";
        try {
          const info = await invoke("play", { path });
          trackPath.textContent = info.path;
          duration.textContent = info.duration_ms
            ? `Duration: ~${info.duration_ms.toLocaleString()} ms`
            : "Duration: -";
          status.textContent = "Playing via rodio/symphonia backend.";
        } catch (error) {
          console.error(error);
          status.textContent = `Failed to play: ${error}`;
        }
      }

      async function callSimple(command) {
        status.textContent = "";
        try {
          await invoke(command);
          status.textContent = command === "stop" ? "Playback stopped." : "";
        } catch (error) {
          console.error(error);
          status.textContent = `Error: ${error}`;
        }
      }

      playBtn.addEventListener("click", play);
      browseBtn.addEventListener("click", async () => {
        status.textContent = "Opening file picker.";
        try {
          const selected = await invoke("pick_file");
          if (typeof selected === "string" && selected.length > 0) {
            pathInput.value = selected;
            status.textContent = "File selected.";
          } else {
            status.textContent = "No file selected.";
          }
        } catch (error) {
          console.error(error);
          status.textContent = `File selection cancelled or failed: ${error}`;
        }
      });
      pauseBtn.addEventListener("click", () => callSimple("pause"));
      resumeBtn.addEventListener("click", () => callSimple("resume"));
      stopBtn.addEventListener("click", () => callSimple("stop"));

      pathInput.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          play();
        }
      });
    </script>
  </body>
</html>
